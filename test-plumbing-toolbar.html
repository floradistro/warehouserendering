<!DOCTYPE html>
<html>
<head>
    <title>Plumbing Toolbar Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #2d2d2d;
            color: #fff;
        }
        button {
            display: block;
            margin: 10px 0;
            padding: 10px 20px;
            background: #3c3c3c;
            color: #ccc;
            border: 1px solid #555;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #4c4c4c;
            color: #fff;
        }
        .output {
            margin-top: 20px;
            padding: 15px;
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            background: #262626;
            border-left: 3px solid #0066cc;
        }
    </style>
</head>
<body>
    <h1>🚰 Plumbing Toolbar Test</h1>
    
    <button onclick="testToolbarClick()">1. Test Target Button Click</button>
    <button onclick="checkForToolbar()">2. Check if Toolbar Exists</button>
    <button onclick="simulateClick()">3. Simulate Target Button Click</button>
    <button onclick="checkStore()">4. Check Store for Pipes</button>
    <button onclick="createDirectPipe()">5. Create Pipe Directly</button>
    
    <div class="output" id="output">
        <div class="log-entry">Ready to test...</div>
    </div>
    
    <script>
        function log(message) {
            const output = document.getElementById('output');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function testToolbarClick() {
            log('Testing toolbar click...');
            
            // Try to find the target button
            const buttons = document.querySelectorAll('button');
            let targetButton = null;
            
            buttons.forEach(btn => {
                if (btn.title === 'Add Example PEX System') {
                    targetButton = btn;
                    log('✅ Found Target button!');
                }
            });
            
            if (targetButton) {
                log('Clicking Target button...');
                targetButton.click();
                log('✅ Button clicked!');
            } else {
                log('❌ Target button not found');
                log('Looking for any toolbar buttons...');
                const toolbarButtons = document.querySelectorAll('[title]');
                log(`Found ${toolbarButtons.length} buttons with titles`);
            }
        }
        
        function checkForToolbar() {
            log('Checking for toolbar...');
            
            // Check for the toolbar container
            const toolbar = document.querySelector('.bg-\\[\\#2d2d2d\\]');
            if (toolbar) {
                log('✅ Found toolbar container');
                
                // Count buttons
                const buttons = toolbar.querySelectorAll('button');
                log(`Found ${buttons.length} buttons in toolbar`);
                
                buttons.forEach((btn, i) => {
                    log(`  Button ${i + 1}: ${btn.title || 'no title'}`);
                });
            } else {
                log('❌ Toolbar not found');
                log('Checking for any buttons...');
                const allButtons = document.querySelectorAll('button');
                log(`Total buttons on page: ${allButtons.length}`);
            }
        }
        
        function simulateClick() {
            log('Simulating Target button click with event...');
            
            // Dispatch the event that the button would trigger
            window.dispatchEvent(new CustomEvent('createExamplePEXSystem', {
                detail: {
                    material: 'pex',
                    systemType: 'cold_water'
                }
            }));
            
            log('✅ Event dispatched');
        }
        
        function checkStore() {
            log('Checking store for pipe systems...');
            
            if (window.__appStore) {
                const state = window.__appStore.getState();
                const pipes = state.elements?.filter(e => e.type === 'pipe_system') || [];
                log(`Found ${pipes.length} pipe systems in store`);
                
                pipes.forEach((pipe, i) => {
                    log(`  Pipe ${i + 1}: ${pipe.id} - ${pipe.material}`);
                });
            } else {
                log('❌ Store not found on window');
            }
        }
        
        function createDirectPipe() {
            log('Creating pipe directly in store...');
            
            if (window.__appStore) {
                const state = window.__appStore.getState();
                
                const testPipe = {
                    id: `test_pipe_${Date.now()}`,
                    type: 'pipe_system',
                    position: { x: 15, y: 15, z: 8 },
                    dimensions: { width: 20, height: 20, depth: 1 },
                    material: 'pex',
                    color: '#0066CC',
                    pipeData: {
                        systemType: 'cold_water',
                        diameter: 1.0,
                        path: [
                            { x: 15, y: 15, z: 8 },
                            { x: 35, y: 15, z: 8 },
                            { x: 35, y: 35, z: 8 }
                        ]
                    },
                    metadata: {
                        pipeSystem: true,
                        materialType: 'pex',
                        systemType: 'cold_water'
                    }
                };
                
                if (state.addElement) {
                    state.addElement(testPipe);
                    log('✅ Pipe added to store!');
                    log(`Pipe ID: ${testPipe.id}`);
                } else {
                    log('❌ No addElement function in store');
                }
            } else {
                log('❌ Store not available');
            }
        }
        
        // Initial check
        setTimeout(() => {
            log('=== Initial Check ===');
            checkForToolbar();
        }, 1000);
    </script>
</body>
</html>
